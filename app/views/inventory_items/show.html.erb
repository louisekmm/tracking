<%= link_to "Home", root_path %> | <p><%= link_to "Create a new inventory item", new_product_inventory_item_path(@product) %></p>


<h2>Inventory</h2>

<table border="1">
  <tr>
    <td>Product</td>
    <td>Total</td>
    <td>In stock</td>
    <td>Incoming</td>
    <td>Reserved</td>
    <td>Min in stock</td>
    <td>Max in stock</td>
    <td>Expiration Date</td>
    <td>Size</td>
    <td>Status</td>
    <td>Edit</td>
    <td>Delete</td>
  </tr>

  <% @product.inventory_items.each do |inventory_item| %>
    <tr>
        <td>@product.name</td>
        <td><%= inventory_item.instock_qty + inventory_item.incoming_qty + inventory_item.incoming_qty %></td>
        <td><%= inventory_item.instock_qty %></td>
        <td><%= inventory_item.incoming_qty %></td>
        <td><%= inventory_item.reserved_qty %></td>
        <td><%= inventory_item.min_instock_qty %></td>
        <td><%= inventory_item.max_instock_qty %></td>
        <td><%= inventory_item.expiration_date %></td>
        <td><%= inventory_item.size %></td>
        <td>
          <% if (inventory_item.expiration_date.to_s..Time.now.strftime("%Y-%m-%d")).count <= 0 %>
            Expired
          <% elsif inventory_item.max_instock_qty >= inventory_item.instock_qty and inventory_item.incoming_qty < inventory_item.min_instock_qty %>
            Low stock
          <% elsif (inventory_item.expiration_date.to_s..Time.now.strftime("%Y-%m-%d")).count < 4 and
          (inventory_item.expiration_date.to_s..Time.now.strftime("%Y-%m-%d")).count > 0 %>
            On sale
          <% else %>
            Ok
          <% end %>

        </td>
        <td><%= link_to "Edit item", edit_product_inventory_item_path(@product, inventory_item) %></td>
        <td>
          <%= link_to "Delete item", product_inventory_item_path(@product, inventory_item), data: {
                      turbo_method: :delete,
                      turbo_confirm: "Do you confirm to delete this inventory item?"
                    } %>
        </td>
    </tr>
  <% end %>
</table>

<% if @product.inventory_items.blank? %>
  No inventory items yet.
<% end %>